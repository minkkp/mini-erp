# 생산 및 재고 관리를 위한 미니 ERP 프로젝트

> ERP 도메인에서 발생하는 재고·생산 정합성 문제를  
> Optimistic Lock과 트랜잭션 설계로 해결한  
> 백엔드 중심 토이 프로젝트입니다.

본 프로젝트는 대규모 트래픽을 처리하는 서비스가 아닌,  
사내 ERP 환경을 가정하여 정합성, 명확한 실패, 운영 관점의 설계 판단에  
초점을 맞추어 구현되었습니다.

---

## 🛠️ 기술 스택

### Backend
- Java 17
- Spring Boot
- Spring Data JPA
- PostgreSQL

### Frontend (보조)
- React
- TypeScript  
※ 백엔드 API 검증용

---

## 📌 프로젝트 목적

- ERP 도메인에서 재고 및 생산 처리 시 발생하는 정합성 문제를 직접 구현
- 동시 수정 상황에서 데이터 무결성을 유지하는 설계 경험
- 트랜잭션 경계, 실패 전략, 이력 관리 등 운영 관점의 백엔드 설계 학습
- 과도한 기술 적용이 아닌, 도메인에 맞는 기술 선택 연습

---

## 🧠 핵심 설계 요약

- Optimistic Lock 기반 동시성 제어
  - 재고(Stock) 엔티티에 @Version 적용
  - 동시 수정 시 충돌 감지 후 명확한 실패 처리

- 단일 트랜잭션 기반 생산 처리
  - 자재 재고 차감
  - 생산 실적 저장
  - 완제품 재고 증가
  - 재고 변경 이력 생성  
  → 하나의 트랜잭션으로 묶어 정합성 보장

- 음수 재고 방지 도메인 로직
  - 재고 차감 시 엔티티 내부에서 수량 검증
  - 잘못된 상태 자체가 생성되지 않도록 설계

- 자동 재시도 미적용
  - ERP 특성상 조용한 재시도보다  
    명확한 실패와 사용자 재시도 유도가 더 중요하다고 판단

---

## 🏗️ 아키텍처 개요

- Application Layer
  - 생산 및 재고 처리 흐름 오케스트레이션
  - 트랜잭션 경계 관리

- Domain
  - Stock: 현재 재고 상태
  - StockHistory: 모든 재고 변경 이력
  - Production: 생산 실적
  - ProductionMaterial: 생산 시 사용된 자재 정보

- Database
  - 재고는 현재 상태만 유지
  - 모든 변경 사항은 이력 테이블에 누적 저장

---

## 🔄 생산 처리 흐름

1. 생산 품목 및 창고 유효성 검증
2. 자재 재고 차감  
   - Optimistic Lock 적용
   - 음수 재고 방지 검증
3. 생산 실적 저장
4. 완제품 재고 증가
5. 재고 변경 이력 생성

모든 단계는 하나의 트랜잭션으로 처리되며,  
중간 실패 시 전체 롤백됩니다.

---

## 🚨 동시성 · 실패 전략

- 재고 동시 수정 시
  - Optimistic Lock 충돌 발생
  - HTTP 409 응답 반환
  - 사용자 재시도 유도

- 자동 재시도를 적용하지 않은 이유
  - 중복 처리 위험
  - 실패 원인 은폐 방지
  - ERP 도메인 특성상 명확한 실패가 더 중요하다고 판단

---

## 🗂️ ERD 설계

- 재고(Stock)는 현재 상태만 관리
- 재고 이력(StockHistory)은 모든 변경 사항을 누적 저장
- (item_id, warehouse_id) 유니크 제약으로 재고 단위 명확화
- 이력 테이블을 통해 감사 및 추적 가능하도록 설계

---

## ⚙️ 재고 스냅샷 배치

- 일별 재고 집계를 위한 스냅샷 테이블 운영
- 배치 실행 시 전체 재고 기준으로 스냅샷 생성
- (item_id, warehouse_id, snapshot_date) 유니크 제약 적용
  - 동일 날짜에 여러 번 실행해도 결과가 동일하도록 설계
- 토이 프로젝트 특성상 findAll() 기반 처리
  - 운영 환경에서는 페이징 또는 파티셔닝 고려 가능

---

## 🖥️ 프론트엔드 구성 (보조)

프론트엔드는 백엔드 API 동작을 검증하고  
ERP 업무 흐름을 시각적으로 확인하기 위한 보조 UI로 구현했습니다.

- React 기반 단일 페이지 구성
- 페이지 단위 상태 관리 및 사용자 액션 처리
- axios 기반 API 레이어 분리
- 백엔드 DTO 기준 타입 정의로 데이터 구조 일관성 유지
- Vite proxy를 통해 로컬 백엔드 서버와 연동  

프론트엔드는 UI 완성도보다는  
명확한 상태 흐름과 백엔드 연동 구조에 초점을 두었습니다.

---

## ✍️ 마무리

본 프로젝트를 통해  
ERP 도메인에서 정합성과 트랜잭션 설계가 왜 중요한지,  
그리고 도메인 특성에 맞는 동시성 제어 전략을 선택하는 과정을  
직접 경험해볼 수 있었습니다.
